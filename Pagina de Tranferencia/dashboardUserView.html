<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Servidor - SMS Rio Preto</title>
    <link rel="stylesheet" href="css/formulario.css">
    <link rel="stylesheet" href="css/dashboardUserView.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .aviso-prazo { background:#fff3cd;color:#856404;border:1px solid #ffc107;border-radius:8px;padding:12px 16px;margin-top:14px;font-size:.9rem; }
        .aviso-info  { background:#d1ecf1;color:#0c5460;border-color:#bee5eb; }
        .btn-editar-pedido { margin-top:14px;background:#0056b3;color:#fff;border:none;border-radius:8px;padding:10px 20px;font-weight:600;cursor:pointer;transition:.2s; }
        .btn-editar-pedido:hover { background:#003f8a; }
        .status-badge.deferido    { background:#d4edda;color:#155724; }
        .status-badge.indeferido  { background:#f8d7da;color:#721c24; }
        .status-badge.contemplado { background:#cce5ff;color:#004085; }
        /* Modal edição */
        .modal-overlay-edit { display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:2000;align-items:center;justify-content:center; }
        .modal-overlay-edit.open,.modal-overlay-edit[style*="flex"] { display:flex; }
        .modal-edit-card { background:#fff;border-radius:14px;width:95%;max-width:580px;box-shadow:0 8px 32px rgba(0,0,0,.18);overflow:hidden; }
        .modal-edit-header { display:flex;justify-content:space-between;align-items:center;padding:18px 24px;background:#003366;color:#fff; }
        .modal-edit-header h3 { font-size:1.1rem;margin:0; }
        .modal-edit-body { padding:24px;display:flex;flex-direction:column;gap:14px; }
        .modal-edit-body label { font-weight:600;font-size:.85rem;color:#003366;display:block;margin-bottom:4px; }
        .modal-edit-body select { width:100%;padding:10px 12px;border:1px solid #d1d9e0;border-radius:8px;font-size:.95rem; }
        .modal-edit-footer { padding:16px 24px;display:flex;justify-content:flex-end;gap:10px;border-top:1px solid #eee; }
        /* Histórico */
        .historico-item { background:#fff;border:1px solid #edf2f7;border-radius:12px;padding:20px;margin-bottom:16px; }
        .historico-header { display:flex;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap; }
        .historico-body p { margin:5px 0;font-size:.9rem; }
    </style>
</head>
<body>
<div class="dashboard-container">
    <aside class="sidebar">
        <div class="brand-area">
            <div class="brasao-container">
                <img src="img/Coat_of_arms_of_São_José_do_Rio_Preto_SP.png" alt="Brasão" class="logo-dashboard">
            </div>
            <span>Portal SMS</span>
        </div>
        <nav class="menu">
            <a href="#" class="menu-item active" data-target="inicio">Início</a>
            <a href="#" class="menu-item" data-target="historico">Meu Histórico</a>
            <a href="#" class="menu-item" data-target="perfil">Meu Perfil</a>
            <a href="#" class="menu-item" data-target="faq">Dúvidas Frequentes</a>
            <a href="index.html" class="menu-item logout">Sair</a>
        </nav>
    </aside>

    <main class="main-content">
        <button class="mobile-menu-toggle" id="mobileMenuToggle"><span></span><span></span><span></span></button>

        <!-- INÍCIO -->
        <section id="inicio" class="content-section active">
            <header class="section-header">
                <h1>Painel do Servidor</h1>
                <button class="btn-primary" onclick="window.location.href='formulario.html'">+ Nova Solicitação</button>
            </header>
            <div class="dashboard-grid">
                <div class="card status-card">
                    <h3>Minha Solicitação Atual</h3>
                    <div id="pedido-info"><p style="color:#888">Carregando...</p></div>
                </div>
                <div class="card rules-card">
                    <h3>Regras de Transferência</h3>
                    <ul class="rules-list">
                        <li>Pedidos podem ser feitos uma vez a cada <strong>06 meses</strong>.</li>
                        <li>Ingresso mínimo de <strong>16 meses</strong> na SMS para solicitar.</li>
                        <li>Pedido <strong>indeferido</strong> permite novo pedido imediatamente.</li>
                        <li>A permuta exige compatibilidade de cargo e jornada.</li>
                        <li>Após transferido, permanência mínima de <strong>01 ano</strong> na nova unidade.</li>
                    </ul>
                    <a href="img/portaria.pdf" target="_blank" class="link-documento">Ler Portaria Completa (PDF)</a>
                </div>
            </div>
        </section>

        <!-- HISTÓRICO -->
        <section id="historico" class="content-section">
            <header class="section-header">
                <h1>Meu Histórico de Pedidos</h1>
                <p>Todos os seus pedidos de transferência, incluindo os já contemplados.</p>
            </header>
            <div id="historico-lista"><p style="color:#888">Carregando...</p></div>
        </section>

        <!-- PERFIL -->
        <section id="perfil" class="content-section">
            <header class="section-header">
                <h1>Meu Perfil</h1>
                <p>Mantenha seus dados sempre atualizados.</p>
            </header>
            <div class="card">
                <form id="updateProfileForm">
                    <div class="form-section-title">Dados Pessoais</div>
                    <div class="grid-row">
                        <div class="form-group">
                            <label for="edit-nome">Nome Completo</label>
                            <input type="text" id="edit-nome" placeholder="Nome do servidor">
                        </div>
                        <div class="form-group">
                            <label for="edit-matricula">Matrícula</label>
                            <input type="text" id="edit-matricula" placeholder="ex: 12345" readonly style="background:#f4f7f9">
                        </div>
                    </div>
                    <div class="grid-row">
                        <div class="form-group">
                            <label for="edit-email">E-mail</label>
                            <input type="email" id="edit-email" placeholder="email@exemplo.com">
                        </div>
                        <div class="form-group">
                            <label for="edit-telefone">Telefone / WhatsApp</label>
                            <input type="tel" id="edit-telefone" placeholder="(17) 00000-0000">
                        </div>
                    </div>
                    <div class="form-section-title">Dados Profissionais</div>
                    <div class="grid-row">
                        <div class="form-group">
                            <label for="edit-cargo">Cargo Atual</label>
                            <select id="edit-cargo"><option value="" disabled>Selecione...</option></select>
                        </div>
                        <div class="form-group">
                            <label for="vinculo">Vínculo</label>
                            <select id="vinculo">
                                <option value="" disabled selected>Selecione...</option>
                                <option value="Funfarme">Funfarme</option>
                                <option value="Prefeitura">Prefeitura</option>
                                <option value="Estadual">Estadual</option>
                                <option value="Federal">Federal</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid-row">
                        <div class="form-group">
                            <label for="edit-unidade">Unidade de Lotação</label>
                            <select id="edit-unidade"><option value="" disabled>Selecione...</option></select>
                        </div>
                        <div class="form-group">
                            <label for="edit-admissao">Data de Admissão</label>
                            <input type="date" id="edit-admissao">
                        </div>
                    </div>
                    <hr class="divider">
                    <div class="form-section-title">Segurança</div>
                    <div class="grid-row">
                        <div class="form-group">
                            <label for="new-pass">Nova Senha</label>
                            <input type="password" id="new-pass" placeholder="Deixe em branco para não alterar">
                        </div>
                        <div class="form-group">
                            <label for="confirm-new-pass">Confirmar Nova Senha</label>
                            <input type="password" id="confirm-new-pass" placeholder="Repita a nova senha">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-secondary">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- FAQ -->
        <section id="faq" class="content-section">
            <header class="section-header"><h1>Perguntas Frequentes</h1></header>
            <div class="faq-container">
                <div class="faq-item">
                    <button class="faq-question">Quanto tempo devo esperar para pedir nova transferência?</button>
                    <div class="faq-answer"><p>De acordo com o Art. 3º §2º da Portaria 02/2022, o pedido pode ser solicitado uma vez a cada 06 meses — exceto se o pedido anterior foi indeferido, caso em que você pode solicitar novamente imediatamente.</p></div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">Posso editar meu pedido depois de enviado?</button>
                    <div class="faq-answer"><p>Sim, enquanto o pedido estiver com status "Em Análise" você pode editar as opções de unidade pelo painel. A data de edição fica registrada.</p></div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">O que significa "Contemplado"?</button>
                    <div class="faq-answer"><p>Contemplado significa que seu pedido deferido atingiu a data prevista de transferência. O pedido é arquivado no seu histórico e você pode solicitar uma nova transferência.</p></div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">Como funciona a transferência por permuta?</button>
                    <div class="faq-answer"><p>A permuta ocorre quando dois profissionais de mesmo cargo e jornada concordam com a troca, dependendo da autorização dos Departamentos envolvidos.</p></div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Modal edição do pedido -->
<div id="modalEditarPedido" class="modal-overlay-edit">
    <div class="modal-edit-card">
        <div class="modal-edit-header">
            <h3>✏️ Editar Pedido de Transferência</h3>
            <button onclick="fecharEdicaoPedido()" style="background:none;border:none;color:#fff;font-size:1.4rem;cursor:pointer;">&times;</button>
        </div>
        <div class="modal-edit-body">
            <p style="font-size:.85rem;color:#555;margin-bottom:4px;">Selecione as unidades em ordem de prioridade. Apenas a 1ª opção é obrigatória.</p>
            <div><label for="edit-opcao1">1ª Opção (obrigatória)</label><select id="edit-opcao1"><option value="">— Selecione —</option></select></div>
            <div><label for="edit-opcao2">2ª Opção</label><select id="edit-opcao2"><option value="">— Nenhuma —</option></select></div>
            <div><label for="edit-opcao3">3ª Opção</label><select id="edit-opcao3"><option value="">— Nenhuma —</option></select></div>
            <div><label for="edit-opcao4">4ª Opção</label><select id="edit-opcao4"><option value="">— Nenhuma —</option></select></div>
            <div><label for="edit-opcao5">5ª Opção</label><select id="edit-opcao5"><option value="">— Nenhuma —</option></select></div>
        </div>
        <div class="modal-edit-footer">
            <button style="background:#6c757d;color:#fff;border:none;border-radius:8px;padding:10px 20px;font-weight:600;cursor:pointer;" onclick="fecharEdicaoPedido()">Cancelar</button>
            <button style="background:#28a745;color:#fff;border:none;border-radius:8px;padding:10px 22px;font-weight:600;cursor:pointer;" id="btnSalvarEdicao" onclick="salvarEdicaoPedido()">Salvar Alterações</button>
        </div>
    </div>
</div>

<script src="js/Api.config.js"></script>
<script src="js/dashboardUserView.js"></script>
</body>
</html>